// FriendList.ets
import router from '@ohos.router';

@Entry
@Component
struct FriendList {
  @State searchText: string = ''
  @State showSearchPage: boolean = false
  @State friends: FriendItem[] = [
    { id: 1, name: 'å¼ ä¸‰', account: 'zhangsan', avatar: '', status: 'åœ¨çº¿', lastActive: 'åˆšåˆš' },
    { id: 2, name: 'æå››', account: 'lisi', avatar: '', status: 'åœ¨çº¿', lastActive: '2åˆ†é’Ÿå‰' },
    { id: 3, name: 'ç‹äº”', account: 'wangwu', avatar: '', status: 'ç¦»çº¿', lastActive: '1å°æ—¶å‰' },
    { id: 4, name: 'èµµå…­', account: 'zhaoliu', avatar: '', status: 'åœ¨çº¿', lastActive: '5åˆ†é’Ÿå‰' }
  ]
  @State searchResults: FriendItem[] = []

  build() {
    Column() {
      // æ ¹æ®çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„é¡µé¢
      if (this.showSearchPage) {
        // æœç´¢é¡µé¢ - å®Œå…¨ç‹¬ç«‹çš„é¡µé¢
        this.SearchPage()
      } else {
        // å¥½å‹åˆ—è¡¨é¡µé¢
        this.FriendListPage()
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  FriendListPage() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ  - åªåœ¨å¥½å‹åˆ—è¡¨é¡µé¢æ˜¾ç¤º
      Row() {
        Text('â†')
          .fontSize(20)
          .fontColor('#007DFF')
          .onClick(() => {
            router.back()
          })

        Text('æˆ‘çš„å¥½å‹')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
          .margin({ left: 12 })

        // æœç´¢æŒ‰é’®
        Text('æœç´¢')
          .fontSize(14)
          .fontColor('#007DFF')
          .padding({ left: 12, right: 12, top: 6, bottom: 6 })
          .backgroundColor('#E6F2FF')
          .borderRadius(16)
          .margin({ left: 12 })
          .onClick(() => {
            this.showSearchPage = true
          })
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#FFFFFF')
      .alignItems(VerticalAlign.Center)

      // å¥½å‹åˆ—è¡¨
      if (this.friends.length > 0) {
        Scroll() {
          Column() {
            ForEach(this.friends, (friend: FriendItem) => {
              this.FriendItem(friend)
            })
          }
          .width('100%')
          .padding({ bottom: 20 })
        }
        .layoutWeight(1)
      } else {
        // ç©ºçŠ¶æ€
        Column() {
          Text('ğŸ‘¥')
            .fontSize(48)
            .margin({ bottom: 16 })
          Text('è¿˜æ²¡æœ‰å¥½å‹')
            .fontSize(16)
            .fontColor('#999999')
            .margin({ bottom: 8 })
          Text('å¿«å»æ·»åŠ å¥½å‹å§')
            .fontSize(14)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .layoutWeight(1)
      }
    }
  }

  @Builder
  SearchPage() {
    Column() {
      // æœç´¢é¡µé¢ç‹¬ç«‹çš„å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(20)
          .fontColor('#007DFF')
          .onClick(() => {
            this.showSearchPage = false
            this.searchText = ''
            this.searchResults = []
          })

        Text('æœç´¢å¥½å‹')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
          .margin({ left: 12 })
          .layoutWeight(1)

        // æœç´¢é¡µé¢ä¹Ÿå¯ä»¥æœ‰é¢å¤–çš„æ“ä½œæŒ‰é’®
        Text('å–æ¶ˆ')
          .fontSize(14)
          .fontColor('#007DFF')
          .onClick(() => {
            this.showSearchPage = false
            this.searchText = ''
            this.searchResults = []
          })
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#FFFFFF')
      .alignItems(VerticalAlign.Center)

      // æœç´¢æ 
      Row() {
        Text('ğŸ”')
          .fontSize(18)
          .fontColor('#666666')
          .margin({ right: 12 })

        TextInput({ placeholder: 'è¾“å…¥å¥½å‹è´¦å·æˆ–æ˜µç§°', text: this.searchText })
          .layoutWeight(1)
          .height(44)
          .fontSize(16)
          .fontColor('#333333')
          .backgroundColor('#F8F9FA')
          .padding(12)
          .borderRadius(22)
          .onChange((value: string) => {
            this.searchText = value
            this.handleSearch(value)
          })
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#FFFFFF')
      .alignItems(VerticalAlign.Center)

      // æœç´¢ç»“æœ
      Scroll() {
        Column() {
          if (this.searchText.length === 0) {
            // æœç´¢æç¤º
            this.SearchTips()
          } else if (this.searchResults.length === 0) {
            // æ— ç»“æœ
            this.EmptyResult()
          } else {
            // æœç´¢ç»“æœ
            ForEach(this.searchResults, (user: FriendItem) => {
              this.SearchResultItem(user)
            })
          }
        }
        .width('100%')
      }
      .layoutWeight(1)
      .padding({ bottom: 20 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  FriendItem(friend: FriendItem) {
    Row() {
      // å¤´åƒ
      Stack({ alignContent: Alignment.Center }) {
        Circle({ width: 50, height: 50 })
          .fill('#E6F2FF')
        Text(friend.name.substring(0, 1))
          .fontSize(18)
          .fontColor('#007DFF')
          .fontWeight(FontWeight.Bold)
      }
      .width(50)
      .height(50)

      // å¥½å‹ä¿¡æ¯
      Column() {
        Text(friend.name)
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        Text(`è´¦å·: ${friend.account}`)
          .fontSize(12)
          .fontColor('#666666')
          .margin({ top: 2 })
      }
      .layoutWeight(1)
      .margin({ left: 12 })
      .alignItems(HorizontalAlign.Start)

      // çŠ¶æ€å’Œæ“ä½œ
      Column() {
        // çŠ¶æ€
        Row() {
          Circle({ width: 8, height: 8 })
            .fill(friend.status === 'åœ¨çº¿' ? '#52C41A' : '#CCCCCC')
            .margin({ right: 4 })
          Text(friend.status)
            .fontSize(12)
            .fontColor(friend.status === 'åœ¨çº¿' ? '#52C41A' : '#999999')
        }

        Text(friend.lastActive)
          .fontSize(10)
          .fontColor('#999999')
          .margin({ top: 2 })
      }
      .alignItems(HorizontalAlign.End)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .border({ width: { bottom: 1 }, color: '#F0F0F0' })
    .onClick(() => {
      this.viewFriendProfile(friend)
    })
  }

  @Builder
  SearchTips() {
    Column() {
      Text('æœç´¢æç¤º')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')
        .margin({ bottom: 16 })
        .width('100%')
        .padding({ left: 16, right: 16 })

      Column() {
        Text('â€¢ è¾“å…¥å¥½å‹çš„è´¦å·æˆ–æ˜µç§°è¿›è¡Œæœç´¢')
          .fontSize(14)
          .fontColor('#666666')
          .margin({ bottom: 8 })
        Text('â€¢ è´¦å·é€šå¸¸æ˜¯æ‰‹æœºå·æˆ–è‡ªå®šä¹‰ID')
          .fontSize(14)
          .fontColor('#666666')
          .margin({ bottom: 8 })
        Text('â€¢ æ”¯æŒæ¨¡ç³Šæœç´¢ï¼Œè¾“å…¥éƒ¨åˆ†ä¿¡æ¯å³å¯')
          .fontSize(14)
          .fontColor('#666666')
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#FFFFFF')
      .borderRadius(12)
      .margin({ left: 16, right: 16 })
    }
    .width('100%')
    .margin({ top: 20 })
  }

  @Builder
  EmptyResult() {
    Column() {
      Text('ğŸ”')
        .fontSize(48)
        .margin({ bottom: 16 })
      Text('æœªæ‰¾åˆ°ç›¸å…³ç”¨æˆ·')
        .fontSize(16)
        .fontColor('#999999')
        .margin({ bottom: 8 })
      Text('è¯·æ£€æŸ¥è´¦å·æˆ–æ˜µç§°æ˜¯å¦æ­£ç¡®')
        .fontSize(14)
        .fontColor('#CCCCCC')
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .margin({ top: 100 })
  }

  @Builder
  SearchResultItem(user: FriendItem) {
    Row() {
      // å¤´åƒ
      Stack({ alignContent: Alignment.Center }) {
        Circle({ width: 50, height: 50 })
          .fill('#E6F2FF')
        Text(user.name.substring(0, 1))
          .fontSize(18)
          .fontColor('#007DFF')
          .fontWeight(FontWeight.Bold)
      }
      .width(50)
      .height(50)

      // ç”¨æˆ·ä¿¡æ¯
      Column() {
        Text(user.name)
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        Text(`è´¦å·: ${user.account}`)
          .fontSize(12)
          .fontColor('#666666')
          .margin({ top: 2 })
      }
      .layoutWeight(1)
      .margin({ left: 12 })
      .alignItems(HorizontalAlign.Start)

      // æ·»åŠ æŒ‰é’®
      Button('æ·»åŠ ', { type: ButtonType.Capsule })
        .width(60)
        .height(30)
        .fontSize(12)
        .fontColor('#FFFFFF')
        .backgroundColor('#007DFF')
        .onClick(() => {
          this.addFriend(user)
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .border({ width: { bottom: 1 }, color: '#F0F0F0' })
  }

  // æœç´¢å¤„ç†
  private handleSearch(keyword: string) {
    if (keyword.trim() === '') {
      this.searchResults = []
      return
    }

    // æ¨¡æ‹Ÿæœç´¢é€»è¾‘ - å®é™…é¡¹ç›®ä¸­è¿™é‡Œè°ƒç”¨API
    const mockUsers: FriendItem[] = [
      { id: 5, name: 'æµ‹è¯•ç”¨æˆ·1', account: 'test1', avatar: '', status: 'åœ¨çº¿', lastActive: 'åˆšåˆš' },
      { id: 6, name: 'æµ‹è¯•ç”¨æˆ·2', account: 'test2', avatar: '', status: 'ç¦»çº¿', lastActive: '1å¤©å‰' }
    ]

    // ç®€å•è¿‡æ»¤é€»è¾‘
    this.searchResults = mockUsers.filter(user =>
    user.name.includes(keyword) || user.account.includes(keyword)
    )
  }

  // æ·»åŠ å¥½å‹
  private addFriend(user: FriendItem) {
    console.info(`æ·»åŠ å¥½å‹: ${user.name}`)
    // è¿™é‡Œè°ƒç”¨æ·»åŠ å¥½å‹çš„API
    // æ·»åŠ æˆåŠŸåæ›´æ–°å¥½å‹åˆ—è¡¨
    this.friends = [...this.friends, user]
    this.showSearchPage = false
    this.searchText = ''
    this.searchResults = []
  }

  // æŸ¥çœ‹å¥½å‹èµ„æ–™
  private viewFriendProfile(friend: FriendItem) {
    console.info(`æŸ¥çœ‹å¥½å‹èµ„æ–™: ${friend.name}`)
    // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°å¥½å‹èµ„æ–™é¡µé¢
  }
}

// å¥½å‹é¡¹æ¥å£
interface FriendItem {
  id: number
  name: string
  account: string
  avatar: string
  status: string
  lastActive: string
}