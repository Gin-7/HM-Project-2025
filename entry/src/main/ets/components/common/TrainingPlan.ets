// TrainingPlan.ets
import router from '@ohos.router';

@Entry
@Component
struct TrainingPlan {
  @State planName: string = 'æˆ‘çš„è®­ç»ƒè®¡åˆ’'
  @State selectedDays: number[] = [1, 3, 5] // 1-7 å‘¨ä¸€åˆ°å‘¨æ—¥
  @State duration: number = 30 // åˆ†é’Ÿ
  @State intensity: string = 'ä¸­ç­‰'
  @State exercises: ExerciseItem[] = []
  @State showExercisePicker: boolean = false

  // è®­ç»ƒç±»å‹æ•°æ®
  private exerciseTypes: ExerciseType[] = [
    { id: 1, name: 'æœ‰æ°§è¿åŠ¨', icon: 'ğŸƒ', color: '#FF6B6B' },
    { id: 2, name: 'åŠ›é‡è®­ç»ƒ', icon: 'ğŸ’ª', color: '#4ECDC4' },
    { id: 3, name: 'æŸ”éŸ§æ€§', icon: 'ğŸ§˜', color: '#45B7D1' },
    { id: 4, name: 'å¹³è¡¡è®­ç»ƒ', icon: 'âš–ï¸', color: '#96CEB4' }
  ]

  // å…·ä½“è®­ç»ƒé¡¹ç›®
  private exerciseItems: ExerciseItem[] = [
    { id: 1, name: 'æ…¢è·‘', type: 'æœ‰æ°§è¿åŠ¨', duration: 20, calories: 150, icon: 'ğŸƒ' },
    { id: 2, name: 'æ¸¸æ³³', type: 'æœ‰æ°§è¿åŠ¨', duration: 30, calories: 200, icon: 'ğŸŠ' },
    { id: 3, name: 'æ·±è¹²', type: 'åŠ›é‡è®­ç»ƒ', duration: 10, calories: 80, icon: 'ğŸ¦µ' },
    { id: 4, name: 'ä¿¯å§æ’‘', type: 'åŠ›é‡è®­ç»ƒ', duration: 10, calories: 70, icon: 'âœ‹' },
    { id: 5, name: 'ç‘œä¼½', type: 'æŸ”éŸ§æ€§', duration: 25, calories: 120, icon: 'ğŸ§˜' },
    { id: 6, name: 'æ‹‰ä¼¸', type: 'æŸ”éŸ§æ€§', duration: 15, calories: 60, icon: 'ğŸ¤¸' },
    { id: 7, name: 'å•è…¿ç«™ç«‹', type: 'å¹³è¡¡è®­ç»ƒ', duration: 10, calories: 40, icon: 'ğŸ¦¶' }
  ]

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆª - æç®€è®¾è®¡
      Row() {
        Text('â†')
          .fontSize(20)
          .fontColor('#2C3E50')
          .onClick(() => {
            router.back()
          })

        Text('è®­ç»ƒè®¡åˆ’')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#2C3E50')
          .margin({ left: 12 })
          .layoutWeight(1)

        Text('ä¿å­˜')
          .fontSize(16)
          .fontColor('#FFFFFF')
          .padding({ left: 20, right: 20, top: 8, bottom: 8 })
          .backgroundColor('#2C3E50')
          .borderRadius(20)
          .onClick(() => {
            this.savePlan()
          })
      }
      .width('100%')
      .padding(20)
      .backgroundColor('#FFFFFF')

      Scroll() {
        Column() {
          // è®¡åˆ’åç§°
          this.PlanNameSection()

          // è®­ç»ƒå¤©æ•°
          this.DaySelectionSection()

          // è®­ç»ƒæ—¶é•¿å’Œå¼ºåº¦
          this.DurationIntensitySection()

          // è®­ç»ƒç±»å‹é€‰æ‹©
          this.ExerciseTypeSection()

          // å·²é€‰è®­ç»ƒé¡¹ç›®
          this.SelectedExercisesSection()

          // æ·»åŠ è®­ç»ƒæŒ‰é’®
          this.AddExerciseButton()
        }
        .width('100%')
        .padding({ bottom: 30 })
      }
      .layoutWeight(1)

      // è®­ç»ƒé¡¹ç›®é€‰æ‹©å™¨
      if (this.showExercisePicker) {
        this.ExercisePicker()
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FAFAFA') // æµ…ç°èƒŒæ™¯ï¼Œinsé£
  }

  @Builder
  PlanNameSection() {
    Column() {
      Text('è®¡åˆ’åç§°')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#2C3E50')
        .margin({ bottom: 12 })
        .alignSelf(ItemAlign.Start)

      TextInput({ placeholder: 'è¾“å…¥è®¡åˆ’åç§°', text: this.planName })
        .width('100%')
        .height(50)
        .fontSize(16)
        .fontColor('#2C3E50')
        .backgroundColor('#FFFFFF')
        .padding(16)
        .borderRadius(12)
        .onChange((value: string) => {
          this.planName = value
        })
    }
    .width('100%')
    .padding(20)
    .margin({ top: 8 })
    .backgroundColor('#FFFFFF')
  }

  @Builder
  DaySelectionSection() {
    Column() {
      Text('è®­ç»ƒå¤©æ•°')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#2C3E50')
        .margin({ bottom: 16 })
        .alignSelf(ItemAlign.Start)

      Row() {
        ForEach([1, 2, 3, 4, 5, 6, 7], (day: number) => {
          Column() {
            Text(this.getDayShortName(day))
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .fontColor(this.selectedDays.includes(day) ? '#FFFFFF' : '#2C3E50')
          }
          .width(40)
          .height(40)
          .justifyContent(FlexAlign.Center)
          .backgroundColor(this.selectedDays.includes(day) ? '#2C3E50' : '#F8F9FA')
          .borderRadius(20)
          .onClick(() => {
            this.toggleDaySelection(day)
          })
          .margin({ right: 8 })
        })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .width('100%')
    .padding(20)
    .margin({ top: 8 })
    .backgroundColor('#FFFFFF')
  }

  @Builder
  DurationIntensitySection() {
    Row() {
      // æ—¶é•¿é€‰æ‹©
      Column() {
        Text('æ—¶é•¿')
          .fontSize(14)
          .fontColor('#7F8C8D')
          .margin({ bottom: 8 })

        Row() {
          Text('-')
            .fontSize(18)
            .fontColor('#2C3E50')
            .padding(8)
            .onClick(() => {
              if (this.duration > 10) this.duration -= 5
            })

          Text(`${this.duration}åˆ†é’Ÿ`)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#2C3E50')
            .margin({ left: 16, right: 16 })

          Text('+')
            .fontSize(18)
            .fontColor('#2C3E50')
            .padding(8)
            .onClick(() => {
              if (this.duration < 120) this.duration += 5
            })
        }
        .alignItems(VerticalAlign.Center)
      }
      .layoutWeight(1)

      // å¼ºåº¦é€‰æ‹©
      Column() {
        Text('å¼ºåº¦')
          .fontSize(14)
          .fontColor('#7F8C8D')
          .margin({ bottom: 8 })

        Row() {
          ForEach(['ä½', 'ä¸­ç­‰', 'é«˜'], (level: string) => {
            Text(level)
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .fontColor(this.intensity === level ? '#FFFFFF' : '#2C3E50')
              .padding({ left: 12, right: 12, top: 6, bottom: 6 })
              .backgroundColor(this.intensity === level ? '#2C3E50' : '#F8F9FA')
              .borderRadius(16)
              .onClick(() => {
                this.intensity = level
              })
              .margin({ right: 8 })
          })
        }
      }
      .layoutWeight(1)
    }
    .width('100%')
    .padding(20)
    .margin({ top: 8 })
    .backgroundColor('#FFFFFF')
  }

  @Builder
  ExerciseTypeSection() {
    Column() {
      Text('è®­ç»ƒç±»å‹')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#2C3E50')
        .margin({ bottom: 16 })
        .alignSelf(ItemAlign.Start)

      Row() {
        ForEach(this.exerciseTypes, (type: ExerciseType) => {
          Column() {
            Text(type.icon)
              .fontSize(24)
              .margin({ bottom: 8 })
            Text(type.name)
              .fontSize(12)
              .fontColor('#2C3E50')
          }
          .width(70)
          .height(70)
          .justifyContent(FlexAlign.Center)
          .backgroundColor('#FFFFFF')
          .border({ width: 1, color: '#ECF0F1' })
          .borderRadius(12)
          .onClick(() => {
            this.filterExercisesByType(type.name)
          })
          .margin({ right: 12 })
        })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .width('100%')
    .padding(20)
    .margin({ top: 8 })
    .backgroundColor('#FFFFFF')
  }

  @Builder
  SelectedExercisesSection() {
    Column() {
      Row() {
        Text('å·²é€‰é¡¹ç›®')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#2C3E50')
          .layoutWeight(1)

        Text(`å…± ${this.exercises.length} é¡¹`)
          .fontSize(14)
          .fontColor('#7F8C8D')
      }
      .width('100%')
      .margin({ bottom: 16 })

      if (this.exercises.length > 0) {
        ForEach(this.exercises, (exercise: ExerciseItem, index: number) => {
          this.ExerciseItem(exercise, index)
        })
      } else {
        Column() {
          Text('æš‚æ— è®­ç»ƒé¡¹ç›®')
            .fontSize(14)
            .fontColor('#BDC3C7')
            .margin({ bottom: 8 })
          Text('ç‚¹å‡»ä¸‹æ–¹æ·»åŠ è®­ç»ƒé¡¹ç›®')
            .fontSize(12)
            .fontColor('#BDC3C7')
        }
        .width('100%')
        .padding(40)
        .backgroundColor('#F8F9FA')
        .borderRadius(12)
      }
    }
    .width('100%')
    .padding(20)
    .margin({ top: 8 })
    .backgroundColor('#FFFFFF')
  }

  @Builder
  ExerciseItem(exercise: ExerciseItem, index: number) {
    Row() {
      Text(exercise.icon)
        .fontSize(20)
        .margin({ right: 12 })

      Column() {
        Text(exercise.name)
          .fontSize(15)
          .fontWeight(FontWeight.Medium)
          .fontColor('#2C3E50')
        Text(`${exercise.duration}åˆ†é’Ÿ Â· ${exercise.calories}å¡è·¯é‡Œ`)
          .fontSize(12)
          .fontColor('#7F8C8D')
          .margin({ top: 2 })
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)

      Text('Ã—')
        .fontSize(18)
        .fontColor('#E74C3C')
        .onClick(() => {
          this.removeExercise(index)
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F8F9FA')
    .borderRadius(12)
    .margin({ bottom: 8 })
  }

  @Builder
  AddExerciseButton() {
    Row() {
      Text('+ æ·»åŠ è®­ç»ƒé¡¹ç›®')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#2C3E50')
    }
    .width('100%')
    .height(50)
    .justifyContent(FlexAlign.Center)
    .backgroundColor('#FFFFFF')
    .border({ width: 1, color: '#2C3E50', style: BorderStyle.Dashed })
    .borderRadius(12)
    .margin({ top: 8 })
    .onClick(() => {
      this.showExercisePicker = true
    })
  }

  @Builder
  ExercisePicker() {
    Column() {
      // åŠé€æ˜é®ç½©
      Column() {
        Column() {
          Text('é€‰æ‹©è®­ç»ƒé¡¹ç›®')
            .fontSize(18)
            .fontWeight(FontWeight.Medium)
            .fontColor('#2C3E50')
            .margin({ bottom: 20 })

          Scroll() {
            Column() {
              ForEach(this.exerciseItems, (exercise: ExerciseItem) => {
                Row() {
                  Text(exercise.icon)
                    .fontSize(20)
                    .margin({ right: 12 })

                  Column() {
                    Text(exercise.name)
                      .fontSize(15)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#2C3E50')
                    Text(exercise.type)
                      .fontSize(12)
                      .fontColor('#7F8C8D')
                      .margin({ top: 2 })
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start)

                  Text('æ·»åŠ ')
                    .fontSize(12)
                    .fontColor('#FFFFFF')
                    .padding({ left: 12, right: 12, top: 6, bottom: 6 })
                    .backgroundColor('#2C3E50')
                    .borderRadius(12)
                    .onClick(() => {
                      this.addExercise(exercise)
                    })
                }
                .width('100%')
                .padding(16)
                .backgroundColor('#FFFFFF')
                .borderRadius(12)
                .margin({ bottom: 8 })
              })
            }
          }
          .layoutWeight(1)

          Button('å…³é—­', { type: ButtonType.Normal })
            .width('100%')
            .height(44)
            .fontSize(16)
            .fontColor('#2C3E50')
            .backgroundColor('#ECF0F1')
            .margin({ top: 16 })
            .onClick(() => {
              this.showExercisePicker = false
            })
        }
        .width('90%')
        .height('70%')
        .padding(24)
        .backgroundColor('#FFFFFF')
        .borderRadius(20)
      }
      .width('100%')
      .height('100%')
      .justifyContent(FlexAlign.Center)
      .alignItems(HorizontalAlign.Center)
      .backgroundColor('#CC000000')
    }
    .width('100%')
    .height('100%')
  }

  // å·¥å…·æ–¹æ³•
  private getDayShortName(day: number): string {
    const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥']
    return days[day - 1]
  }

  private toggleDaySelection(day: number) {
    if (this.selectedDays.includes(day)) {
      this.selectedDays = this.selectedDays.filter(d => d !== day)
    } else {
      this.selectedDays = [...this.selectedDays, day]
    }
  }

  private filterExercisesByType(type: string) {
    this.showExercisePicker = true
    // è¿™é‡Œå¯ä»¥æ ¹æ®ç±»å‹ç­›é€‰ï¼Œæš‚æ—¶æ˜¾ç¤ºæ‰€æœ‰
  }

  private addExercise(exercise: ExerciseItem) {
    this.exercises = [...this.exercises, exercise]
    this.showExercisePicker = false
  }

  private removeExercise(index: number) {
    this.exercises.splice(index, 1)
    this.exercises = [...this.exercises]
  }

  private savePlan() {
    console.info('ä¿å­˜è®­ç»ƒè®¡åˆ’:', {
      name: this.planName,
      days: this.selectedDays,
      duration: this.duration,
      intensity: this.intensity,
      exercises: this.exercises
    })
    // è¿™é‡Œè°ƒç”¨ä¿å­˜API
    router.back()
  }
}

// ç±»å‹å®šä¹‰
interface ExerciseType {
  id: number
  name: string
  icon: string
  color: string
}

interface ExerciseItem {
  id: number
  name: string
  type: string
  duration: number
  calories: number
  icon: string
}